{"version":3,"file":"datePick.js","sourceRoot":"","sources":["../../../../src/components/datePick/datePick.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\";\n\nimport { format } from \"date-fns\";\nimport { Calendar as CalendarIcon } from \"lucide-react\";\nimport * as React from \"react\";\n\n// 定义日期范围类型\nexport type DateRange = {\n  start: {\n    date?: Date;\n    time: string;\n  };\n  end: {\n    date?: Date;\n    time: string;\n  };\n};\n\n// 定义日期时间范围类型\nexport type DateTimeRange = {\n  from?: Date;\n  to?: Date;\n};\n\n// 时间格式验证正则\ntype TimeFormatValidator = (time: string) => boolean;\n\nimport { zhCN } from \"date-fns/locale\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\n\ninterface DateTimeRangePickerProps {\n  onChange?: (value: [Date, Date] | null, dateString: [string, string]) => void;\n  onOk?: (value: [Date, Date] | null) => void;\n  onError?: (error: string) => void;\n  format?: string;\n  showTime?: boolean | { format: string };\n  className?: string;\n  minDate?: Date;\n  maxDate?: Date;\n  initialValue?: [Date, Date] | null;\n}\n\nexport function DateTimeRangePicker({\n  onChange,\n  onOk,\n  onError,\n  format: dateFormat = \"yyyy-MM-dd HH:mm\",\n  showTime = { format: \"HH:mm\" },\n  className,\n  minDate,\n  maxDate,\n  initialValue = null,\n}: DateTimeRangePickerProps) {\n  // 状态管理\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [error, setError] = React.useState<string | null>(null);\n\n  // 工具函数 - 验证时间格式是否有效\n  const isValidTimeFormat: TimeFormatValidator = (time) => {\n    const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;\n    return timeRegex.test(time);\n  };\n\n  // 工具函数 - 将完整日期对象分离为日期部分和时间字符串\n  const splitDateTime = (date: Date): { date: Date; time: string } => {\n    // 创建日期部分（不含时间）\n    const dateOnly = new Date(\n      date.getFullYear(),\n      date.getMonth(),\n      date.getDate()\n    );\n    // 提取时间部分为HH:mm格式\n    const hours = date.getHours().toString().padStart(2, \"0\");\n    const minutes = date.getMinutes().toString().padStart(2, \"0\");\n\n    return { date: dateOnly, time: `${hours}:${minutes}` };\n  };\n\n  // 初始化函数 - 根据initialValue获取初始日期范围状态\n  const getInitialDateRange = (): DateRange => {\n    // 安全检查initialValue\n    if (\n      initialValue &&\n      Array.isArray(initialValue) &&\n      initialValue.length === 2 &&\n      initialValue[0] instanceof Date &&\n      initialValue[1] instanceof Date &&\n      !isNaN(initialValue[0].getTime()) &&\n      !isNaN(initialValue[1].getTime())\n    ) {\n      const startDateTime = splitDateTime(initialValue[0]);\n      const endDateTime = splitDateTime(initialValue[1]);\n      return {\n        start: { date: startDateTime.date, time: startDateTime.time },\n        end: { date: endDateTime.date, time: endDateTime.time },\n      };\n    }\n\n    // 默认值：不选择任何日期\n    return {\n      start: { date: undefined, time: \"00:00\" },\n      end: { date: undefined, time: \"23:59\" },\n    };\n  };\n\n  // 使用懒初始化设置日期范围状态\n  const [dateRange, setDateRange] = React.useState<DateRange>(() =>\n    getInitialDateRange()\n  );\n\n  // 操作函数 - 重置组件到初始状态\n  const resetDateRange = () => {\n    setDateRange(getInitialDateRange());\n    setError(null);\n  };\n\n  // 工具函数 - 将日期和时间字符串合并为完整日期对象\n  const combineDateTime = (\n    date: Date | undefined,\n    time: string\n  ): Date | undefined => {\n    // 基本验证\n    if (!date || !isValidTimeFormat(time)) return undefined;\n\n    // 解析时间部分\n    const [hours, minutes] = time.split(\":\").map(Number);\n\n    // 验证小时和分钟是否为有效数字\n    if (isNaN(hours) || isNaN(minutes)) return undefined;\n\n    // 创建新的日期对象并设置时间\n    const newDate = new Date(date);\n    newDate.setHours(hours, minutes, 0, 0);\n\n    // 确保生成的日期是有效的\n    return isNaN(newDate.getTime()) ? undefined : newDate;\n  };\n\n  // 验证函数 - 检查日期范围是否有效\n  const isValidDateRange = (start: Date, end: Date): boolean => {\n    // 检查日期是否在有效范围内（基于minDate）\n    if (minDate && (start < minDate || end < minDate)) {\n      setError(`日期不能早于 ${format(minDate, \"yyyy-MM-dd\")}`);\n      return false;\n    }\n\n    // 检查日期是否在有效范围内（基于maxDate）\n    if (maxDate && (start > maxDate || end > maxDate)) {\n      setError(`日期不能晚于 ${format(maxDate, \"yyyy-MM-dd\")}`);\n      return false;\n    }\n\n    // 检查开始日期是否不晚于结束日期\n    if (start > end) {\n      setError(\"开始日期不能晚于结束日期\");\n      return false;\n    }\n\n    // 验证通过，清除错误状态\n    setError(null);\n    return true;\n  };\n\n  // 工具函数 - 获取格式化的日期字符串\n  const getFormattedDate = (date: Date | undefined): string => {\n    if (!date) return \"\";\n    return format(date, dateFormat);\n  };\n\n  // 事件处理函数 - 处理日期选择变化\n  const handleDateChange = (dates: DateTimeRange | undefined) => {\n    setDateRange((prev) => ({\n      start: dates?.from ? { ...prev.start, date: dates.from } : prev.start,\n      end: dates?.to ? { ...prev.end, date: dates.to } : prev.end,\n    }));\n\n    // 清除错误状态当用户更改日期时\n    setError(null);\n  };\n\n  // 事件处理函数 - 处理确认按钮点击\n  const handleOk = () => {\n    // 验证时间格式\n    if (!isValidTimeFormat(dateRange.start.time)) {\n      const errorMsg = \"开始时间格式无效，请使用 HH:MM 格式\";\n      setError(errorMsg);\n      onError?.(errorMsg);\n      return;\n    }\n\n    if (!isValidTimeFormat(dateRange.end.time)) {\n      const errorMsg = \"结束时间格式无效，请使用 HH:MM 格式\";\n      setError(errorMsg);\n      onError?.(errorMsg);\n      return;\n    }\n\n    // 合并日期和时间\n    const startDateTime = combineDateTime(\n      dateRange.start.date,\n      dateRange.start.time\n    );\n    const endDateTime = combineDateTime(dateRange.end.date, dateRange.end.time);\n\n    // 验证并处理有效日期范围\n    if (startDateTime && endDateTime) {\n      // 验证日期范围\n      if (!isValidDateRange(startDateTime, endDateTime)) {\n        onError?.(error!);\n        return;\n      }\n\n      // 准备回调参数\n      const value: [Date, Date] = [startDateTime, endDateTime];\n      const dateString: [string, string] = [\n        getFormattedDate(startDateTime),\n        getFormattedDate(endDateTime),\n      ];\n\n      // 触发回调\n      onChange?.(value, dateString);\n      onOk?.(value);\n    }\n\n    // 关闭弹窗\n    setIsOpen(false);\n  };\n\n  // 计算显示状态 - 按钮上显示的日期文本\n  const displayText =\n    dateRange.start.date && dateRange.end.date\n      ? `${format(dateRange.start.date, \"yyyy-MM-dd\")} ${\n          dateRange.start.time\n        } - ${format(dateRange.end.date, \"yyyy-MM-dd\")} ${dateRange.end.time}`\n      : \"选择日期范围\";\n\n  // 计算显示状态 - 传递给日历组件的已选择范围\n  const selectedRange =\n    dateRange.start.date && dateRange.end.date\n      ? { from: dateRange.start.date, to: dateRange.end.date }\n      : undefined;\n\n  return (\n    <div className={cn(\"grid gap-2\", className)}>\n      <Popover open={isOpen} onOpenChange={setIsOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className={cn(\n              \"w-full justify-start text-left font-normal transition-all hover:bg-muted/50\",\n              !dateRange.start.date && \"text-muted-foreground\"\n            )}\n          >\n            <CalendarIcon className=\"mr-2 h-4 w-4 text-primary\" />\n            <span className=\"truncate\">{displayText}</span>\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent\n          className=\"w-auto p-0 shadow-lg rounded-lg border-0 overflow-hidden\"\n          align=\"start\"\n        >\n          <div className=\"p-4 bg-background border rounded-lg\">\n            {error && (\n              <div className=\"mb-3 p-2 bg-destructive/10 text-destructive text-sm rounded-md\">\n                {error}\n              </div>\n            )}\n            <Calendar\n              mode=\"range\"\n              locale={zhCN}\n              selected={selectedRange}\n              onSelect={handleDateChange}\n              className=\"rounded-md border mb-3 shadow-sm w-full\"\n            />\n\n            {showTime && (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4 p-3 bg-muted/30 rounded-md\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"start-time\" className=\"text-sm font-medium\">\n                    开始时间\n                  </Label>\n                  <Input\n                    id=\"start-time\"\n                    type=\"time\"\n                    value={dateRange.start.time}\n                    onChange={(e) =>\n                      setDateRange((prev) => ({\n                        ...prev,\n                        start: { ...prev.start, time: e.target.value },\n                      }))\n                    }\n                    className=\"w-full min-w-[120px] border-muted-foreground/20 focus:border-primary transition-all\"\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"end-time\" className=\"text-sm font-medium\">\n                    结束时间\n                  </Label>\n                  <Input\n                    id=\"end-time\"\n                    type=\"time\"\n                    value={dateRange.end.time}\n                    onChange={(e) =>\n                      setDateRange((prev) => ({\n                        ...prev,\n                        end: { ...prev.end, time: e.target.value },\n                      }))\n                    }\n                    className=\"w-full min-w-[120px] border-muted-foreground/20 focus:border-primary transition-all\"\n                  />\n                </div>\n              </div>\n            )}\n\n            <div className=\"flex justify-end gap-3 mt-5 pt-3 border-t border-border\">\n              <Button\n                variant=\"ghost\"\n                onClick={() => {\n                  const today = new Date();\n                  // 创建只包含日期部分的对象\n                  const todayDate = new Date(\n                    today.getFullYear(),\n                    today.getMonth(),\n                    today.getDate()\n                  );\n\n                  setDateRange((prev) => ({\n                    start: { ...prev.start, date: todayDate },\n                    end: { ...prev.end, date: todayDate },\n                  }));\n\n                  // 清除错误状态\n                  setError(null);\n                }}\n              >\n                此刻 (跳转到今天)\n              </Button>\n              <Button\n                variant=\"ghost\"\n                onClick={() => {\n                  resetDateRange();\n                }}\n                className=\"hover:bg-muted transition-colors\"\n              >\n                重置\n              </Button>\n              <Button\n                variant=\"secondary\"\n                onClick={() => setIsOpen(false)}\n                className=\"hover:bg-muted transition-colors\"\n              >\n                取消\n              </Button>\n              <Button\n                onClick={handleOk}\n                className=\"bg-primary hover:bg-primary/90 transition-colors\"\n              >\n                确定\n              </Button>\n            </div>\n          </div>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n\nexport default DateTimeRangePicker;\n"]}